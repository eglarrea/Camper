<main class="page-wrapper manage-parking-page">
  <header class="d-flex justify-content-between align-items-start align-items-md-center mb-4 parking-header">
    <h1 class="page-title">
      {{ isEditMode ? ('MANAGE_PARKING.EDIT' | translate) : ('MANAGE_PARKING.NEW' | translate) }}
    </h1>

    <a routerLink="/admin/dashboard" class="btn btn-secondary mt-2 mt-md-0">
      ← {{ 'MANAGE_PARKING.BACK' | translate }}
    </a>
  </header>

  <form [formGroup]="parkingForm" (ngSubmit)="saveParking()" class="parking-form">
    <section class="mb-5">
      <h2 class="section-title">{{ 'MANAGE_PARKING.GENERAL' | translate }}</h2>

      <div class="row g-3">
        <div class="col-12 col-md-6 form-group-standard">
          <label class="form-label-custom">{{ 'MANAGE_PARKING.NAME' | translate }} *</label>
          <input type="text" formControlName="nombreParking">
        </div>

        <div class="col-12 col-md-6 form-group-standard">
          <label class="form-label-custom">{{ 'MANAGE_PARKING.EMAIL' | translate }} *</label>
          <input type="email" formControlName="emailParking">
        </div>

        <div class="col-12 col-md-6 form-group-standard">
          <label class="form-label-custom">{{ 'MANAGE_PARKING.PROVINCE' | translate }}</label>
          <input type="text" formControlName="provinciaParking">
        </div>

        <div class="col-12 col-md-6 form-group-standard">
          <label class="form-label-custom">{{ 'MANAGE_PARKING.CITY' | translate }}</label>
          <input type="text" formControlName="municipioParking">
        </div>

        <div class="col-12 col-md-6 form-group-standard">
          <label class="form-label-custom">{{ 'MANAGE_PARKING.WEB' | translate }}</label>
          <input type="text" formControlName="webParking">
        </div>

        <div class="col-12 col-md-6 form-group-standard">
          <label class="form-label-custom">{{ 'MANAGE_PARKING.PHONE' | translate }}</label>
          <input type="text" formControlName="telefonoParking">
        </div>
      </div>

      <div class="d-flex flex-wrap gap-3 mt-4">
        <label>
          <input type="checkbox" formControlName="isActivoParking">
          {{ 'MANAGE_PARKING.ACTIVE' | translate }}
        </label>

        <label>
          <input type="checkbox" formControlName="tieneElectricidadParking">
          {{ 'MANAGE_PARKING.ELECTRICITY' | translate }}
        </label>

        <label>
          <input type="checkbox" formControlName="tieneResidualesParking">
          {{ 'MANAGE_PARKING.RESIDUALS' | translate }}
        </label>

        <label>
          <input type="checkbox" formControlName="tienePlazasVipParking">
          {{ 'MANAGE_PARKING.VIP' | translate }}
        </label>
      </div>

      <div class="mt-4">
        <button type="submit" class="btn btn-primary" [disabled]="isLoading">
          {{ isLoading ? ('MANAGE_PARKING.SAVING' | translate) : ('MANAGE_PARKING.SAVE' | translate) }}
        </button>
      </div>
    </section>

    <section *ngIf="isEditMode">
      <div class="d-flex justify-content-between align-items-center mb-3 plazas-div">
        <h2 class="section-title">
          {{ 'MANAGE_PARKING.SPOTS' | translate }} ({{ plazas.length }})
        </h2>

        <button type="button" class="btn btn-secondary" (click)="openSpotModal()">
          + {{ 'MANAGE_PARKING.ADD_SPOT' | translate }}
        </button>
      </div>

      <div class="table-responsive table-wrapper">
        <table class="table table-striped align-middle plazas-table">
          <thead>
            <tr>
              <th>{{ 'MANAGE_PARKING.SPOT_NAME' | translate }}</th>
              <th>{{ 'MANAGE_PARKING.PRICE' | translate }}</th>
              <th>{{ 'MANAGE_PARKING.FEATURES' | translate }}</th>
              <th>{{ 'MANAGE_PARKING.STATUS' | translate }}</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let plaza of plazas">
              <td><strong>{{ plaza.nombre }}</strong></td>
              <td>{{ plaza.precio }}€</td>
              <td>
                <span *ngIf="plaza.esVip">VIP </span>
                <span *ngIf="plaza.tieneElectricidad">Electricidad</span>
                <span *ngIf="!plaza.esVip && !plaza.tieneElectricidad">-</span>
              </td>
              <td>
                <span [class.free]="plaza.estado === '0'" [class.occupied]="plaza.estado !== '0'">
                  {{ plaza.estado === '0' ? ('MANAGE_PARKING.FREE' | translate) : ('MANAGE_PARKING.OCCUPIED' | translate) }}
                </span>
              </td>
              <td>
                <button class="btn btn-secondary btn-sm" type="button" (click)="openSpotModal(plaza)">
                  {{ 'MANAGE_PARKING.EDIT_SPOT' | translate }}
                </button>
              </td>
            </tr>

            <tr *ngIf="plazas.length === 0">
              <td colspan="5" class="text-center small-text">
                {{ 'MANAGE_PARKING.NO_SPOTS' | translate }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="showSpotModal" class="spot-modal-backdrop" (click)="closeSpotModal()">
        <div class="spot-modal" (click)="$event.stopPropagation()">
          <div class="spot-modal-header">
            <h3>
              {{ currentSpotId ? ('MANAGE_PARKING.EDIT_SPOT' | translate) : ('MANAGE_PARKING.ADD_SPOT' | translate) }}
            </h3>
            <button type="button" (click)="closeSpotModal()">×</button>
          </div>

          <form [formGroup]="spotForm" (ngSubmit)="saveSpot()">
            <div class="form-group-standard">
              <label class="form-label-custom">{{ 'MANAGE_PARKING.SPOT_NAME' | translate }}</label>
              <input type="text" formControlName="nombre">
            </div>

            <div class="form-group-standard">
              <label class="form-label-custom">{{ 'MANAGE_PARKING.PRICE' | translate }}</label>
              <input type="number" formControlName="precio">
            </div>

            <div class="form-group-standard">
              <label class="form-label-custom">{{ 'MANAGE_PARKING.STATUS' | translate }}</label>
              <select formControlName="estado">
                <option value="0">{{ 'MANAGE_PARKING.FREE' | translate }}</option>
                <option value="1">{{ 'MANAGE_PARKING.OCCUPIED' | translate }}</option>
              </select>
            </div>

            <div class="d-flex gap-4 mb-3">
              <label>
                <input type="checkbox" formControlName="esVip">
                VIP
              </label>

              <label>
                <input type="checkbox" formControlName="tieneElectricidad">
                {{ 'MANAGE_PARKING.ELECTRICITY' | translate }}
              </label>
            </div>

            <div class="d-flex flex-column justify-content-end gap-3">
              <button type="button" class="btn btn-secondary" (click)="closeSpotModal()">
                {{ 'MANAGE_PARKING.CANCEL' | translate }}
              </button>

              <button type="submit" class="btn btn-primary">
                {{ 'MANAGE_PARKING.SAVE_SPOT' | translate }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </section>
  </form>
</main>
