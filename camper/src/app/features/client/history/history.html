<div class="history-page">

  <h1 class="page-title">{{ 'HISTORY.TITLE' | translate }}</h1>

  <!-- FILTROS -->
  <section class="history-search">

    <form
      class="search-bar-wrapper"
      [formGroup]="filterForm"
      (ngSubmit)="applyFilters()"
    >
      <div class="search-bar">

        <!-- FECHA DESDE -->
        <div class="search-field date">
          <i class="fa-regular fa-calendar"></i>
          <input
            type="date"
            formControlName="fechaDesde"
            (click)="openDatePicker($event)"
          >
        </div>

        <div class="divider"></div>

        <!-- FECHA HASTA -->
        <div class="search-field date">
          <i class="fa-regular fa-calendar"></i>
          <input
            type="date"
            formControlName="fechaHasta"
            (click)="openDatePicker($event)"
          >
        </div>

        <div class="divider"></div>

        <!-- PARKING -->
        <div class="search-field">
          <i class="fa-solid fa-location-dot"></i>
          <input
            type="text"
            formControlName="nombreParking"
            placeholder="{{ 'HISTORY.PARKING' | translate }}"
          >
        </div>

        <div class="divider"></div>

        <!-- ESTADO -->
        <div class="search-field select-field">
          <i class="fa-solid fa-flag"></i>

          <select formControlName="estado" class="search-select">
            <option value="">{{ 'HISTORY.ALL' | translate }}</option>
            <option value="1">{{ 'HISTORY.CONFIRMED' | translate }}</option>
            <option value="0">{{ 'HISTORY.CANCELLED' | translate }}</option>
          </select>

          <i class="fa-solid fa-chevron-down select-arrow"></i>
        </div>

        <!-- BOTÓN FILTRAR -->
        <div class="botones">
          <button
            type="submit"
            class="btn btn-primary search-button"
            [disabled]="isLoading"
          >
            {{ 'HISTORY.FILTER' | translate }}
          </button>

          <button
            type="button"
            class="btn btn-secondary"
            (click)="clearFilters()"
          >
            {{ 'HISTORY.CLEAR' | translate }}
          </button>
        </div>

      </div>

    </form>
  </section>

  <!-- LOADING -->
  <div *ngIf="isLoading" class="loading-msg">
    <i class="fa-solid fa-spinner loading-icon"></i>
    {{ 'HISTORY.LOADING' | translate }}
  </div>

  <!-- LISTADO -->
  <div *ngIf="!isLoading">

    <p *ngIf="filteredBookings.length === 0" class="empty-msg">
      {{ 'HISTORY.EMPTY' | translate }}
    </p>

    <article
      *ngFor="let booking of filteredBookings"
      class="history-card"
      [class.cancelled]="booking.estado === '0'"
    >

      <div class="card-header">
        <div>
          <h3>{{ booking.parkingNombre || ('HISTORY.PARKING_GENERIC' | translate) }}</h3>
          <small>
            {{ 'HISTORY.REQUEST_DATE' | translate }}:
            {{ booking.fecAlta | date:'dd/MM/yyyy' }}
          </small>
        </div>

        <span
          class="status"
          [class.confirmed]="booking.estado === '1'"
          [class.cancelled]="booking.estado === '0'"
        >
          {{ getStatusLabel(booking.estado) | translate }}
        </span>
      </div>

      <div class="card-body">
        <p>
          <strong>{{ 'HISTORY.REFERENCE' | translate }}:</strong>
          #{{ booking.id }}
        </p>

        <p *ngIf="booking.fecInicio && booking.fecFin">
          <strong>{{ 'HISTORY.DATES' | translate }}:</strong>
          {{ booking.fecInicio | date:'dd/MM/yyyy' }}
          –
          {{ booking.fecFin | date:'dd/MM/yyyy' }}
        </p>

        <p>
          <strong>{{ 'HISTORY.TOTAL' | translate }}:</strong>
          {{ (booking.precioTotal > 0 ? booking.precioTotal : booking.precio) | currency:'EUR' }}
        </p>

        <p *ngIf="booking.puntuacion">
          <strong>{{ 'HISTORY.RATING' | translate }}:</strong>
          {{ booking.puntuacion }}/10
        </p>
      </div>

      <div class="card-actions">
        <a
          class="btn btn-primary"
          [routerLink]="['/client/booking', booking.id]"
        >
          {{ 'HISTORY.DETAILS' | translate }}
        </a>
      </div>

    </article>
  </div>

</div>
